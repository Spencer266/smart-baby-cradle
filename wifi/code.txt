#include <WiFi.h>
#include <WiFiClient.h>
#include <SD.h>
#include "ESP32_FTPClient.h"

#define WIFI_SSID "le le"
#define WIFI_PASS "22072003"

// Pin configuration for the SD card module
const int SD_CS_PIN = 5;

char ftp_server[] = "192.168.50.94";
char ftp_user[]   = "lele";
char ftp_pass[]   = "22072003";

void setup() {
  Serial.begin(115200);

  WiFi.begin(WIFI_SSID, WIFI_PASS);

  Serial.println("Connecting Wifi...");
  while (WiFi.status() != WL_CONNECTED) {
      delay(500);
      Serial.print(".");
  }
  Serial.println("");
  Serial.print("IP address: ");
  Serial.println(WiFi.localIP());

  // Initialize SD card
  if (!SD.begin(SD_CS_PIN)) {
    Serial.println("SD card initialization failed!");
    while (1);
  }
  Serial.println("SD card initialized");

  // Open FTP connection
  ESP32_FTPClient ftp(ftp_server, ftp_user, ftp_pass, 5000, 0);
  ftp.OpenConnection();
  Serial.println("ftp oce");
  // Upload the file from SD card to FTP server
  File file = SD.open("/foo.txt");
  if (file) {
    ftp.InitFile("Type I");
    ftp.NewFile("foo.txt");
    while (file.available()) {
      unsigned char data = file.read();
      ftp.WriteData(&data, 1);
    }
    file.close();
    ftp.CloseFile();
    Serial.println("File upload successful");
  } else {
    Serial.println("Error opening file");
  }

  // Close FTP connection
  ftp.CloseConnection();
}

void loop() {

}